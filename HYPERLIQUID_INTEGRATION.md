# Hyperliquid Integration

This document describes the integration between the cron jobs project and the Hyperliquid Python API for automated trading signal execution.

## Overview

The integration allows trading signals generated by the system to be automatically sent to the Hyperliquid vault for position creation. **Only signals from the top 10 influencers are sent to the Hyperliquid API** for immediate execution.

## Top 10 Influencers

The following influencers are authorized to send signals to the Hyperliquid vault:

1. **RiddlerDeFi**
2. **AltcoinLevi**
3. **TradeMogulPro**
4. **dippy_eth**
5. **CryptoHeroTA**
6. **CryptoEnact**
7. **CryptoTraderRai**
8. **Ashikur1589**
9. **MuroCrypto**
10. **BenjiGanar**

### Influencer Filtering

- Only signals from the above top 10 influencers are sent to the Hyperliquid API
- Signals from other influencers are still processed and stored in the database for backtesting purposes
- The system logs when signals are skipped due to influencer not being in the top 10 list

## Components

### 1. Hyperliquid Signal Service (`src/services/hyperliquidSignalService.js`)

A dedicated service that handles:
- Signal validation
- Data formatting for API consumption
- HTTP communication with the Python API
- Error handling and logging

### 2. Configuration (`src/config/config.js`)

Added Hyperliquid API configuration:
```javascript
hyperliquid: {
    apiUrl: process.env.HYPERLIQUID_API_URL || 'http://localhost:5000/signal',
    timeout: parseInt(process.env.HYPERLIQUID_API_TIMEOUT) || 10000
}
```

### 3. Integration Point (`src/services/signalGeneration.js`)

The signal generation process now:
- Automatically sends signals to the Hyperliquid API **only for top 10 influencers**
- Stores all signals in the database regardless of influencer status
- Logs when signals are sent or skipped based on influencer status

### 4. Top 10 Influencers Management

- **`TOP_10_INFLUENCERS`** - Array containing the list of top 10 influencers
- **`isTop10Influencer(twitterHandle)`** - Function to check if an influencer is in the top 10 list
- **`testTop10Influencers()`** - Test utility to verify the functionality

## Environment Variables

Add these to your `.env` file:

```env
HYPERLIQUID_API_URL=http://localhost:5000/signal
HYPERLIQUID_API_TIMEOUT=10000
```

## Signal Format

The service sends signals in the following format to the Python API:

```json
{
  "Signal Message": "buy",
  "Token Mentioned": "VIRTUAL",
  "TP1": 1.192,
  "TP2": 1.2,
  "SL": 1.18,
  "Current Price": 1.19,
  "Max Exit Time": {"$date": "2025-08-07T11:20:29.000Z"}
}
```

## API Endpoints

The Python API expects signals at the `/signal` endpoint and supports:

- `POST /signal` - Receive and execute trading signals
- `GET /positions` - Get current positions
- `POST /close-all-positions` - Close all positions
- `POST /close-position/<symbol>` - Close specific position
- `GET /status` - Get monitoring status
- `GET /health` - Health check

## Error Handling

The service includes comprehensive error handling:

1. **Validation Errors**: Checks for required fields before sending
2. **Network Errors**: Handles connection timeouts and network issues
3. **API Errors**: Logs detailed error responses from the Python API
4. **Graceful Degradation**: Continues processing even if API calls fail
5. **Influencer Filtering**: Logs when signals are skipped due to influencer status

## Testing

Use the test scripts to verify the integration:

```bash
# Test Hyperliquid signal service
node src/utils/testHyperliquidSignal.js

# Test top 10 influencers functionality
node src/utils/testTop10Influencers.js
```

## Usage

The integration is automatic - no additional code is required. When signals are generated:

1. **All signals** are stored in the database for backtesting
2. **Only signals from top 10 influencers** are sent to the Hyperliquid API
3. The system logs the status of each signal processing attempt

### Manual Usage

```javascript
const { processAndSendSignal } = require('./services/hyperliquidSignalService');
const { isTop10Influencer } = require('./services/signalGeneration');

const signalData = {
    signal: 'buy',
    tokenMentioned: 'BTC',
    targets: [50000, 52000],
    stopLoss: 48000,
    currentPrice: 49000,
    maxExitTime: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString()
};

// Check if influencer is in top 10
if (isTop10Influencer('RiddlerDeFi')) {
    const result = await processAndSendSignal(signalData);
    console.log(result);
} else {
    console.log('Influencer not in top 10 - signal not sent to Hyperliquid API');
}
```

## Monitoring

The service logs all API interactions:
- Signal payloads being sent (only for top 10 influencers)
- API responses received
- Error details for failed requests
- Skipped signals due to influencer not being in top 10 list

Check the console logs for detailed information about signal processing.

## Security Notes

- Never expose `.env` files containing API keys
- The Python API should be secured with appropriate authentication
- Consider implementing rate limiting for API calls
- Monitor API usage to prevent abuse
- Top 10 influencers list should be regularly reviewed and updated as needed 